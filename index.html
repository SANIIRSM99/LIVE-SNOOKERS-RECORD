<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>SNOOKERS  LIVE DATA WITH CASH</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="ur">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snooker Tables - Manager Monitor</title>

  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>

  <style>
    body { margin:0; padding:20px; background:#0a0a0a; color:#e0e0e0; font-family:Segoe UI, sans-serif; }
    h1 { text-align:center; color:#ffd700; margin:10px 0 20px; font-size:2.3rem; }
    #wallet-box {
      background:#1e3a2e; border:2px solid #4ade80; border-radius:12px;
      padding:20px; margin:0 auto 30px; max-width:500px; text-align:center;
      box-shadow:0 6px 20px rgba(74,222,128,0.3);
    }
    #wallet-amount { font-size:2.8rem; font-weight:bold; color:#a3ffba; margin:10px 0; }
    .receive-btn {
      background:#2a9d8f; color:white; border:none; padding:12px 24px;
      font-size:1.1rem; border-radius:8px; cursor:pointer; margin-top:12px;
    }
    .receive-btn:hover { background:#238c7e; }
    h2.section-title { text-align:center; margin:25px 0 15px; font-size:1.7rem; padding-bottom:6px; border-bottom:2px solid; }
    .free-section h2 { color:#90ff9e; border-bottom-color:#4ade80; }
    .busy-section h2 { color:#ff6b6b; border-bottom-color:#e63946; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(340px,1fr)); gap:20px; max-width:1800px; margin:0 auto 40px; }
    .card {
      background:#181818; border-radius:12px; padding:20px; box-shadow:0 6px 16px rgba(0,0,0,0.7);
      border:2px solid; position:relative; transition:all 0.2s;
    }
    .card:hover { transform:translateY(-5px); box-shadow:0 12px 28px rgba(0,0,0,0.8); }
    .busy { border-color:#e63946; background:linear-gradient(145deg,#2d0005,#180000); }
    .free  { border-color:#4ade80; background:linear-gradient(145deg,#0f2e1f,#0a2418); }
    .cash-box {
      margin-top:12px; padding:10px; background:rgba(255,255,255,0.08); border-radius:8px;
      text-align:center; font-size:1.15rem;
    }
    .collect-btn {
      background:#e63946; color:white; border:none; padding:10px 16px;
      border-radius:6px; cursor:pointer; font-size:1rem; font-weight:bold;
      margin-top:10px; display:block; width:100%;
    }
    .collect-btn:hover { background:#c53039; }
    .unlock-btn {
      position:absolute; top:12px; right:12px; background:#e63946; color:white;
      border:none; padding:6px 12px; border-radius:6px; cursor:pointer;
      font-size:0.9rem; font-weight:bold;
    }
    .unlock-btn:hover { background:#c53039; }
    .empty-message {
      grid-column:1/-1; text-align:center; padding:50px 20px; color:#777;
      font-size:1.4rem; background:#222; border-radius:12px; border:1px dashed #444;
    }
  </style>
</head>
<body>

<h1>Snooker Tables - Live Manager Monitor</h1>

<div id="wallet-box">
  <div style="font-size:1.3rem; color:#ccc;">کل والٹ (Total Cash Collected)</div>
  <div id="wallet-amount">Rs. 0</div>
  <button class="receive-btn" onclick="receiveAllCash()">Receive / Clear Wallet</button>
</div>

<div class="free-section">
  <h2 class="section-title">خالی ٹیبلز (Free Tables)</h2>
  <div class="grid" id="free-tables-grid"></div>
</div>

<div class="busy-section">
  <h2 class="section-title">مصروف ٹیبلز (Busy Tables)</h2>
  <div class="grid" id="busy-tables-grid"></div>
</div>

<script>
// ────────────────────────────── Firebase Config ──────────────────────────────
const firebaseConfig = {
  apiKey: "AIzaSyDjF_POrbldRLFGTYqbhVB7DO2f_PVNIiU",
  authDomain: "snooker-13eba.firebaseapp.com",
  databaseURL: "https://snooker-13eba-default-rtdb.firebaseio.com",
  projectId: "snooker-13eba",
  storageBucket: "snooker-13eba.firebasestorage.app",
  messagingSenderId: "798005790037",
  appId: "1:798005790037:web:70222de563a0803b285bdc",
  measurementId: "G-ME8ZK3K0RV"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const TOTAL_TABLES = 15;
const freeGrid = document.getElementById("free-tables-grid");
const busyGrid = document.getElementById("busy-tables-grid");
const walletAmountEl = document.getElementById("wallet-amount");

// والٹ real-time
db.ref("wallet").on("value", (snap) => {
  const amount = snap.val() || 0;
  walletAmountEl.textContent = `Rs. ${amount.toLocaleString()}`;
});

// ٹیبلز real-time
db.ref("tables").on("value", (snapshot) => {
  freeGrid.innerHTML = "";
  busyGrid.innerHTML = "";

  let freeCount = 0;
  let busyCount = 0;
  let knownTables = new Set();

  snapshot.forEach((child) => {
    const tableNum = parseInt(child.key);
    knownTables.add(tableNum);
    const data = child.val() || {};

    const card = createTableCard(tableNum, data);

    if (data.status === "busy") {
      busyGrid.appendChild(card);
      busyCount++;
    } else {
      freeGrid.appendChild(card);
      freeCount++;
    }
  });

  for (let i = 1; i <= TOTAL_TABLES; i++) {
    if (!knownTables.has(i)) {
      const card = createTableCard(i, { status: "free", gamesPlayed: 0 });
      freeGrid.appendChild(card);
      freeCount++;
    }
  }

  if (freeCount === 0) freeGrid.innerHTML = '<div class="empty-message">کوئی خالی ٹیبل نہیں</div>';
  if (busyCount === 0) busyGrid.innerHTML = '<div class="empty-message">کوئی مصروف ٹیبل نہیں</div>';
});

function createTableCard(num, data) {
  const card = document.createElement("div");
  card.className = `card ${data.status === "busy" ? "busy" : "free"}`;

  const games = data.gamesPlayed || 0;
  const cashDue = games * 100;

  let html = `
    <h2>ٹیبل ${num}</h2>
    <div class="status">${data.status === "busy" ? "مصروف" : "خالی"}</div>
    <div class="info-line">کل گیمز: <strong>${games}</strong></div>
    <div class="cash-box">
      <div>واجب الادا کیش: <strong>Rs. ${cashDue.toLocaleString()}</strong></div>
    </div>
  `;

  if (games > 0) {
    html += `
      <button class="collect-btn" onclick="collectCash(${num}, ${games})">
        Cash Collect (Rs. ${cashDue.toLocaleString()})
      </button>
    `;
  }

  if (data.status === "busy") {
    html += `
      <button class="unlock-btn" onclick="unlockTable(${num})">
        Unlock / Free
      </button>
    `;
  }

  card.innerHTML = html;
  return card;
}

// Cash Collect → گیمز صفر + والٹ میں شامل
window.collectCash = function(tableNumber, gamesCount) {
  if (!confirm(`ٹیبل ${tableNumber} کی تمام ${gamesCount} گیمز کا کیش (Rs. ${gamesCount * 100}) جمع کرنا ہے؟`)) {
    return;
  }

  const tableRef = db.ref(`tables/${tableNumber}`);

  tableRef.transaction((data) => {
    if (!data) return data;

    const amountToAdd = (data.gamesPlayed || 0) * 100;

    // والٹ میں اضافہ
    db.ref("wallet").transaction((wallet) => (wallet || 0) + amountToAdd);

    // ٹیبل کی گیمز صفر
    data.gamesPlayed = 0;

    return data;
  }).then(() => {
    alert(`ٹیبل ${tableNumber} کا کیش جمع ہو گیا اور گیمز صفر ہو گئیں`);
  }).catch(err => {
    alert("مسئلہ: " + err.message);
  });
};

// Unlock ٹیبل
window.unlockTable = function(tableNumber) {
  if (!confirm(`ٹیبل ${tableNumber} کو free کرنا ہے؟`)) return;

  db.ref(`tables/${tableNumber}`).update({
    status: "free",
    currentGame: null
  }).then(() => {
    alert(`ٹیبل ${tableNumber} free ہو گیا`);
  }).catch(err => alert("مسئلہ: " + err.message));
};

// والٹ ریسیو / کلیئر
window.receiveAllCash = function() {
  if (!confirm("کیا والٹ کا پورا بیلنس ریسیو کر کے صفر کرنا ہے؟")) return;

  db.ref("wallet").set(0).then(() => {
    alert("والٹ صفر کر دیا گیا (ریسیوڈ)");
  }).catch(err => alert("مسئلہ: " + err.message));
};
</script>
</body>
</html>
    <script  src="./script.js"></script>

  </body>
  
</html>
